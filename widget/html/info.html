<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>马上贷</title>
<base href="../">
<meta name="viewport" content="width=device-width,initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
<link href="css/home.css" rel="stylesheet" type="text/css" media="all" />
<link href="css/css.css" rel="stylesheet" type="text/css" media="all" />

<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<!--基础样式-->
<link rel="stylesheet" type="text/css" href="iconfont/iconfont.css">
<link rel="stylesheet" type="text/css" href="css/mobile_base.css">
<!--页面样式-->
<link rel="stylesheet" type="text/css" href="css/me.css">
<!--js-->
<script src="js/jquery-1.8.3.min.js"></script> 
<script src="js/app_mian.js"></script>


<script>

var user_Boolean   = false;

var email_Boolean  = false;
var card_Boolean   = false;
var addr_Boolean   = false; 

var paypwd_Boolean = false;

$(function(){
    
    var userID = window.parent.token.value;

    $.ajax({
        type:'GET',
        url:"http://119.23.46.11/user/backuserinfo",
        data:'user_token='+userID,
        dataType:'json',
        success:function(msg){

            if(msg.status == 1){
                
                if(msg.data.user_head != 'image/tou.png'){

                    $('#user_head').attr('src', 'http://119.23.46.11/'+msg.data.user_head);
                }

                $('#user_name').val(msg.data.user_name);
                $('#user_tel').attr('placeholder',msg.data.user_tel);
                $('#user_email').val(msg.data.user_email);
                $('#user_card').val(msg.data.user_card);
                $('#user_paypwd').val(msg.data.user_paypwd);
                $('#user_addr').val(msg.data.user_addr);


                if(msg.data.user_name != ''){
                    user_Boolean   = true;
                }
                if(msg.data.user_email != ''){
                    email_Boolean   = true;
                }
                if(msg.data.user_card != ''){
                    card_Boolean   = true;
                }
                if(msg.data.user_paypwd != ''){
                    paypwd_Boolean   = true;
                }
                if(msg.data.user_addr != ''){
                    addr_Boolean   = true;
                }


            }else{

                alert('页面加载失败，请重试！')
            }
        }
    })
})
</script>

</head>

<body>

<!--top-->

<div class="top">
	<div class="box">
        <a href="javascript:void(0);" id="back" class="return"><img src="image/return.png"></a>
        个人信息    
    </div>
</div>

<form id="demo" autocomplete="off">
<div class="ten_money" style="margin-top:44px;">
	<div class="box">
    <br>
    	<ul>
            <center>
                <a href="html/cut_avatar.html"><img id="user_head" src="image/tou.png" style="height:100px;border-radius:50% 50% 50% 50%"></a>
            </center>
            <br>
<!--     <li>
        <span>User：</span>
        <input type="text" name="" value="" placeholder="4-8位用户名" class="reg_user">
        <span class="user_hint"></span>
    </li> -->
            <li>
                <span>用户名</span>
                <i><input type="text" id="user_name" name="user_name" vlaue="" placeholder="请输入2-8位字符" class="reg_user" style="position:relative;right:22%;"></i><span class="user_hint" style="position:absolute;right:8%"></span>
            </li>
            <br>
            <li>
            	<span>手机号</span>
                <i><input type="text" id="user_tel" name="user_tel" placeholder="" placeholder="请输入手机号" disabled class="reg_tel" style="position:relative;right:22%;"></i><span class="tel_hint" style="position:absolute;right:8%"></span>
              <!-- <i><input type="text" value="17601112526"><font id="user_tel" style="position:relative;right:22%;display:inline-block;"></font></i> -->
            </li>
            <br>
            <li>
            	<span>邮箱</span>
                <i><input type="text" id="user_email" name="user_email" value="" placeholder="请输入邮箱" class="reg_email" style="position:relative;right:22%;"></i><span class="email_hint" style="position:absolute;right:8%"></span>
            </li>
            <br>
            <li>
                <span>身份证号</span>
                <i><input type="text" id="user_card" name="user_card" value="" placeholder="请输入身份证号" class="reg_card" style="position:relative;right:22%;"></i><span class="card_hint" style="position:absolute;right:8%"></span>
            </li>
            <br>
            <li>
                <span>居住地址</span>
                <i><input type="text" id="user_addr" name="user_addr" value="" placeholder="请输入居住地址" class="reg_addr" style="position:relative;right:22%;"></i><span class="addr_hint" style="position:absolute;right:8%"></span>
            </li>
            <br>
            <li>
            <span>支付密码</span>
            <i><input type="password" id="user_paypwd" name="user_paypwd" class="input_text_password mima_dd" class="reg_paypwd" style="margin-top:10px;position:relative;right:22%;" placeholder="请输入6位数字" >
            <input name="check_user_paypwd" type="text" class="input_text_password mima_wz" style="display:none;margin-top:10px;position:relative;right:22%;" placeholder="请输入6位数字" ></i>
           
            <!--<input name="" type="password" class="input_text_password mima_dd" style="margin-top:10px;" placeholder="请输入密码" >
            <input name="" type="text" class="input_text_password mima_wz" style="display:none;margin-top:10px;" placeholder="请输入密码" >-->
            <a class="eyes_box " data-show="1" href="javascript:void(0);" style="position:absolute;right:8%"><i class="icon iconfont" >&#xe624;</i></a>

            </li>
            <br>
<div class="us_rec">
    <span><a href="javascript:void(0);" id="save">保存</a></span>
    <span><a href="javascript:void(0);" id="reset" style="background:#fff; border:1px solid #29a7e2; color:#29a7e2;">清空</a></span>
</div>

        </ul>
    </div>
</div>
</form>
</body>

<script>


//正则判断用户名是否正确
$('.reg_user').blur(function(){
  
    if ((/^[\u4e00-\u9fa5a-zA-Z\d]{2,8}$/).test($(".reg_user").val())){
        $('.user_hint').html("✔").css("color","green");
        user_Boolean = true;
    }else {
        $('.user_hint').html("×").css("color","red");
        user_Boolean = false;
    }
});

//正则判断邮箱是否正确
$('.reg_email').blur(function(){
    if ((/^[a-z\d]+(\.[a-z\d]+)*@([\da-z](-[\da-z])?)+(\.{1,2}[a-z]+)+$/).test($(".reg_email").val())){
        $('.email_hint').html("✔").css("color","green");
        email_Boolean = true;
    }else {
        $('.email_hint').html("×").css("color","red");
        email_Boolean = false;
    }
});


//正则判断身份证号是否正确
$('.reg_card').blur(function(){
    if ((/^[1-9]\d{7}((0\d)|(1[0-2]))(([0|1|2]\d)|3[0-1])\d{3}$|^[1-9]\d{5}[1-9]\d{3}((0\d)|(1[0-2]))(([0|1|2]\d)|3[0-1])\d{3}([0-9]|X)$/).test($(".reg_card").val())){
        $('.card_hint').html("✔").css("color","green");
        card_Boolean = true;
    }else {
        $('.card_hint').html("×").css("color","red");
        card_Boolean = false;
    }
});

//正则判断居住地址是否正确
$('.reg_addr').blur(function(){
    if ((/^[\u4e00-\u9fa5\d]{6,30}$/).test($(".reg_addr").val())){
        $('.addr_hint').html("✔").css("color","green");
        addr_Boolean = true;
    }else {
        $('.addr_hint').html("×").css("color","red");
        addr_Boolean = false;
    }
});

//正则判断支付密码是否填写
$('#user_paypwd').blur(function(){
    if ((/^\d{6}$/).test($("#user_paypwd").val())){
        paypwd_Boolean = true;
    }else {
        paypwd_Boolean = false;
    }
})

$('#reset').click(function(){
    var statu = confirm("你确定要清空数据吗?");
    if(!statu){
        return false;
    }else{
        $("input").attr("value","");

        user_Boolean   = false;

        email_Boolean  = false;
        card_Boolean   = false;
        addr_Boolean   = false; 

        paypwd_Boolean = false;
    }
});

$('#back').click(function(){
    var statu = confirm("退出之后数据无法保存，你确定要退出吗?");
    if(!statu){
        return false;
    }else{
        history.go(-1);
    }
})

$('#save').click(function(){
    
    if(user_Boolean && email_Boolean && card_Boolean && addr_Boolean && paypwd_Boolean == true){

        sendInfo()

    }else{
        alert("请在您提交修改前确认您的信息是否填写正确");
    }
});

function sendInfo(){

    var userID       = window.parent.token.value;
    var user_name    = $('#user_name').val();
    var user_email   = $('#user_email').val();
    var user_card    = $('#user_card').val();
    var user_addr    = $('#user_addr').val();
    var user_paywpd  = $('#user_paypwd').val();
 
    $.ajax({
        type:'POST',
        url:"http://119.23.46.11/user/updateuserinfo",
        data:'user_name='+user_name+"&user_email="+user_email+"&user_card="+user_card+"&user_addr="+user_addr+"&user_paypwd="+user_paywpd+"&user_token="+userID,
        dataType:'json',  
        success:function(msg){

            if(msg.status == 1){
                alert('已成功保存修改');
                history.go(-1);
            }else{
                alert('页面加载失败，请重试');
            }
        }
    })
}
</script>

</html>
